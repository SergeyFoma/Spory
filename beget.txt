Виртуальный сервер «Pleasant Leonora» успешно создан

IP-адрес:	31.129.111.50
Имя пользователя:	root
Способ авторизации:	Password
OC:	Ubuntu 24.04
Пароль:	4cvSGr*rZPHY
Тариф "Simple"
 Стоимость в день:	 7 руб.
 Стоимость в месяц:	 210 руб.
 
(ls -la ~/exam | grep sock)
 

Кол-во ядер:
1SSD:
10 ГбПамять:
1 Гб
 

cd /var/www/myproject
source venv/bin/activate

перезагрузите nginx командой
sudo systemctl restart nginx

            перезагрузите gunicorn
sudo systemctl restart gunicorn

Инструкцию по работе с панелью управления VPS вы можете посмотреть в разделе Руководство по работе с VPS на нашем сайте.

 

Вы всегда можете обратиться в нашу техническую поддержку, и мы постараемся помочь.

Сайт:	https://beget.com
E-mail:	support@beget.com
Telegram:	@begetbot
Skype:	добавить (только чат)
 
Телефон:	8 (800) 700-06-08
(бесплатно по России)
0 (800) 802-192
(бесплатно по Украине)
------------------------------------------------------
https://beget.com/ru/kb/how-to/web-apps/python#ustanovka-i-nastroyka-django
https://beget.com/ru/kb/how-to/web-apps/obshhie-svedeniya-po-ustanovke-prilozhenij-virtualnoe-okruzhenie-docker#

Телеграм-канал Django: https://t.me/django_selfedu

Beget: https://beget.com

PuTTY: https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html

Инструкция по настройке: https://beget.com/ru/kb/how-to/vps/razvertyvanie-django-s-pomoshchyu-nginx-postgresql-i-gunicorn

-------------------------------------------------------------------
            Command

sudo apt update
sudo apt install python3-pip python3-dev python3-venv libpq-dev postgresql postgresql-contrib nginx
sudo apt install build-essential libpython3-dev  #компилятор

-------------Создание базы данных и пользователя PostgreSQL----------------
sudo -u postgres psql   #запуск консоли postgress

CREATE DATABASE exam_db;
CREATE USER exam WITH PASSWORD '11111qqqqq';

ALTER ROLE exam SET client_encoding TO 'utf8';
ALTER ROLE exam SET default_transaction_isolation TO 'read committed';
ALTER ROLE exam SET timezone TO 'UTC';

GRANT ALL PRIVILEGES ON DATABASE exam_db TO exam;
ALTER DATABASE exam_db OWNER TO exam;

Для выхода из консоли PostgreSQL введите команду: \q
------------------------------------------------------------------
  В PuTTY

  cd /var/www
  mkdir myproject
  ----------------------------------
  в vscode создаём requirements.txt
  pip freeze > requirements.txt

  ----Зипуем проект и загружаем на beget--------
  cd myproject
  python3 -m venv venv

  source venv/bin/activate
  pip list 
  pip install gunicorn psycopg2-binary
  pip install -r requirements.txt
  --------------------------------------------------

gunicorn --bind 0.0.0.0:8000 exam.wsgi
gunicorn --bind 0.0.0.0:8000 exam.wsgi:application
-----------------------------------------------------------------
[Unit]
Description=gunicorn daemon
After=network.target

[Service]
User=root
Group=www-data
WorkingDirectory=/var/www/myproject
ExecStart=/var/www/myproject/venv/bin/gunicorn --access-logfile - --workers 3 --bind unix:/var/www/myproject/exam.sock exam.wsgi:application

[Install]
WantedBy=multi-user.target
------------------------------------------------------------
:wq сохраняем файл
-------------------------
deactivate  выходим из окружения venv
-----------------------------
      Njinx

server {
    listen 80;
    server_name tests-on.ru *.tests-on.ru;

    location = /favicon.ico { access_log off; log_not_found off; }
    location /static/ {
        root /var/www/venv/myproject;
    }
    location /media/ {
        root /var/www/venv/myproject;
    }

    location / {
        include proxy_params;
        proxy_pass http://unix:/var/www/myproject/exam.sock;
    }
}

------------------------
sudo systemctl restart nginx
sudo systemctl restart gunicorn
ls -la ~/myproject | grep sock
namei -nom /var/www/myproject/exam.sock

    подключаем статику
sudo chmod 755 /var/www/myproject/static
---------------------------------------------------------
                КОМАНДЫ

sudo apt update
sudo apt install python3-pip python3-dev python3-venv libpq-dev postgresql postgresql-contrib nginx

sudo apt install build-essential libpython3-dev

        Создание и настройка БД самостоятельно
        Для создания БД самостоятельно нам потребуется дополнительно установить пакеты 
        Postgresql и нужные ей библиотеки из репозиториев Ubuntu командой:

sudo apt install postgresql postgresql-contrib

        По умолчанию для локальных подключений Postgres позволяет использовать БД 
        без дополнительной аутентификации, если имя пользователя системы совпадает с 
        существующим пользователем Postgres.

        В процессе установки PostgreSQL автоматически создается пользователь ОС postgres, 
        а также соответствующий пользователь PostgreSQL с правами администратора. 
        Для входа в интерактивную сессию Postgres используем команду sudo с 
        соответствующим именем пользователя:

sudo -u postgres psql

        В результате выполнения команды откроется консоль PostgreSQL. 
        Создадим базу данных и пользователя для нее:

CREATE DATABASE myproject;
CREATE USER myprojectuser WITH PASSWORD 'password';

        Далее изменим некоторые настройки для данного пользователя, 
        что несколько ускорит операции с базой данных, поскольку корректные значения 
        не потребуется выставлять при каждом запросе. В качестве стандартной кодировки 
        выставим UTF-8, поскольку это кодировка, ожидаемая Django. 
        В качестве часового пояса установим UTC, в качестве схемы изоляции 
        транзакций – “read committed”. Данные настройки соответствуют рекомендованным 
        в документации Django.

ALTER ROLE myprojectuser SET client_encoding TO 'utf8';
ALTER ROLE myprojectuser SET default_transaction_isolation TO 'read committed';
ALTER ROLE myprojectuser SET timezone TO 'UTC';

        После чего выдадим права администратора для созданной БД нашему пользователю, 
        а также сделаем его владельцем БД:

GRANT ALL PRIVILEGES ON DATABASE myproject TO myprojectuser;
ALTER DATABASE myproject OWNER TO myprojectuser;

        Для выхода из консоли PostgreSQL введите команду:
\q

_______________________________________________________________
            создаем директорию проекта
cd /var/www
mkdir myproject
cd /var/www/myproject

            создаем окружение venv
python3 -m venv venv
source venv/bin/activate

pip list
            устанавливаем пакеты
pip install gunicorn psycopg2-binary
pip install -r requirements.txt
_______________________________________________________________
            settings.py

from pathlib import Path
import os

ALLOWED_HOSTS = ['tests-on.ru', 'www.tests-on.ru']

DATABASES = {
    "default": {
        "ENGINE": 'django.db.backends.postgresql_psycopg2',
        "USER": "exam",
        "NAME": "exam_db",
        "PASSWORD": "11111qqqqq",
        "HOST": "localhost",
        "PORT": "",
    }
}

STATIC_URL = '/static/'
STATIC_ROOT = os.path.join(BASE_DIR, 'static/')

python3 manage.py makemigrations
python3 manage.py migrate

python3 manage.py createsuperuser

python3 manage.py collectstatic

sudo ufw allow 8000
python3 manage.py runserver 0.0.0.0:8000

_______________________________________________________________
            Проверка работы Gunicorn в venv

gunicorn --bind 0.0.0.0:8000 exam.wsgi

deactivate

            Создание и запуск Gunicorn с помощью сервиса systemd

sudo vim /etc/systemd/system/gunicorn.service

[Unit]
Description=gunicorn daemon
After=network.target

[Service]
User=root
Group=www-data
WorkingDirectory=/var/www/myproject
ExecStart=/var/www/myproject/venv/bin/gunicorn --access-logfile - --workers 3 --bind unix:/var/www/myproject/exam.sock exam.wsgi:application

Restart = on-failure

[Install]
WantedBy=multi-user.target

        Теперь можно запустить сервер командой:
sudo systemctl enable --now gunicorn

        Проверка работы сервиса systemd
sudo systemctl status gunicorn

sudo systemctl daemon-reload
sudo systemctl restart gunicorn

_______________________________________________________________
        Настройка Nginx в качестве реверс-прокси к Gunicorn
                    создадим файл конфигурации 

sudo vim /etc/nginx/sites-available/myproject

server {
    listen 80;
    server_name tests-on.ru *.tests-on.ru;

    location = /favicon.ico { access_log off; log_not_found off; }
    location /static/ {root /var/www/myproject;}
    location /media/ {root /var/www/myproject;}

    location / {
        include proxy_params;
        proxy_pass http://unix:/var/www/myproject/exam.sock;
    }
}

            Для того чтобы активировать конфиг для Nginx, создайте символьную ссылку на него

sudo ln -s /etc/nginx/sites-available/myproject /etc/nginx/sites-enabled

            проверьте конфиг nginx на предмет синтаксических ошибок:
sudo nginx -t

            перезагрузите nginx командой
sudo systemctl restart nginx

            перезагрузите gunicorn
sudo systemctl restart gunicorn

            необходимо закрыть порт 8000, который мы открывали ранее, и открыть 80 порт на firewall.
sudo ufw delete allow 8000
sudo ufw allow 'Nginx Full'

sudo chmod 755 /var/www/myproject/static

____________________________________________________________________
            Переход на протокол HTTPS 
SSL сертификат - от Let's Encrypt на 90 дней бесплатно

        Установим sertbot в PuTTY(клиент)
root@ycvgxevsgk:/var/www/myproject# sudo apt install python3-certbot-nginx -y

certbot --nginx -d tests-on.ru
certbot --nginx -v tests-on.ru

-----------------------------------------------------
                Djino


Логин: j12841701
Пароль: Cc9f8TmeG